// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets   = ["native", "linux-musl"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}


model Persona{
  id        Int      @id @default(autoincrement())
  externalId String   @unique @default(uuid())
  nombre    String
  apellido  String
  identificacion     String   @unique
  telefono  String
  direccion String
  cuenta   Cuenta?
  docente Docente?
  estudiante Estudiante?
  firma String @default("")
}

model Cuenta{
  id        Int      @id @default(autoincrement())
  externalId String   @unique @default(uuid())
  correo String @unique
  clave String
  persona   Persona  @relation(fields: [personaId], references: [id], onDelete: Cascade)
  personaId Int @unique
  rol_id Int 
  rol Rol @relation(fields: [rol_id], references: [id])
}

model Rol{
  id        Int      @id @default(autoincrement())
  externalId String   @unique @default(uuid())
  nombre    String @unique
  descripcion String  
  cuenta Cuenta[]
}

model Docente {
  id        Int      @id @default(autoincrement())
  externalId String   @unique @default(uuid())
  titulo String
  persona   Persona  @relation(fields: [personaId], references: [id], onDelete: Cascade)
  personaId Int @unique
  registroTutorias RegistroTutorias?
  materia Materia[]
  tutorias  Tutoria[]
}

model Estudiante {
  id        Int      @id @default(autoincrement())
  externalId String   @unique @default(uuid())
  ciclo String
  paralelo String
  carrera String
  persona   Persona  @relation(fields: [personaId], references: [id], onDelete: Cascade)
  personaId Int @unique
  tutoria Tutoria[]
}

model RegistroTutorias{
  id        Int      @id @default(autoincrement())
  externalId String   @unique @default(uuid())
  periodoAcademico String
  docente  Docente  @relation(fields: [docenteId], references: [id], onDelete: Cascade)
  docenteId Int @unique
  tutorias Tutoria[]
}

model Tutoria{
  id        Int      @id @default(autoincrement())
  externalId String   @unique @default(uuid())
  fechaInicio DateTime?
  fechaFinalizacion DateTime?
  estado String?
  nombreTutoria String?
  descripcion String?
  registroTutorias RegistroTutorias  @relation(fields: [registroTutoriasId], references: [id])
  registroTutoriasId Int
  materia Materia  @relation(fields: [materiaId], references: [id])
  materiaId Int
  estudiantes Estudiante[]
  docente Docente @relation(fields: [docenteId], references: [id], onDelete: Cascade)
  docenteId Int
  valoracion Int?
  tipoReunionTutoria String?
  observacionEstudiante String?
  observacionDocente String?
  justificacion String?
}

model Materia{
  id        Int      @id @default(autoincrement())
  externalId String   @unique @default(uuid())
  nombre String
  docente  Docente  @relation(fields: [docenteId], references: [id], onDelete: Cascade)
  docenteId Int 
  tutoria Tutoria[]
}
